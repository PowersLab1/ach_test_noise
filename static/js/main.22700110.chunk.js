(this.webpackJsonpach_test_noise=this.webpackJsonpach_test_noise||[]).push([[0],{143:function(e,t,n){},150:function(e,t,n){e.exports=n.p+"static/media/rating_keydown_1.d9fbf22f.png"},151:function(e,t,n){e.exports=n.p+"static/media/rating_keydown_2.6a659dd4.png"},152:function(e,t,n){e.exports=n.p+"static/media/rating_keydown_3.d955b91a.png"},153:function(e,t,n){e.exports=n.p+"static/media/rating_keydown_4.c8b7c686.png"},154:function(e,t,n){e.exports=n.p+"static/media/rating_keydown_5.34958048.png"},156:function(e,t,n){e.exports=n(322)},161:function(e,t,n){},162:function(e,t,n){},163:function(e,t,n){},170:function(e,t){},172:function(e,t){},182:function(e,t){},184:function(e,t){},211:function(e,t){},213:function(e,t){},214:function(e,t){},219:function(e,t){},221:function(e,t){},227:function(e,t){},229:function(e,t){},248:function(e,t){},260:function(e,t){},263:function(e,t){},28:function(e){e.exports=JSON.parse('{"taskVersion":"1.0.0","taskName":"ach_test_noise","debug":false,"awsLambda":{"saveTaskData":{"host":"de8cnjde61.execute-api.us-east-2.amazonaws.com","path":"/default/saveTaskData"},"fetchLink":{"host":"3pnzb6n9vf.execute-api.us-east-2.amazonaws.com","path":"/default/fetchLink"}}}')},301:function(e,t,n){},302:function(e,t,n){},303:function(e,t,n){},304:function(e,t,n){},305:function(e,t,n){},306:function(e,t,n){},308:function(e,t,n){},309:function(e,t,n){},310:function(e,t,n){},321:function(e,t,n){},322:function(e,t,n){"use strict";n.r(t),n.d(t,"history",(function(){return Ce}));var a=n(0),i=n.n(a),o=n(148),s=n.n(o),r=(n(161),n(2)),c=n(3),u=n(5),l=n(4),d=(n(162),n(11)),m=n(29),p=n(53),h=n.n(p);n(163),n(15),n(164);function f(){try{return localStorage.setItem("test","test"),localStorage.removeItem("test"),!0}catch(e){return!1}}var g=Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));var v=function(){var e={background:127.5,angle:Math.floor(135*Math.random())+45,imsize:256,initcontrast:.5,threshold:.2,phases:[0,.25],phase:0,alpha:.5,ppd:80,frequency:0};return e.phase=e.phases[Math.round(Math.random())],e.frequency=2/e.ppd,e}(),y=(function(e,t){e.map((function(e){return v.background+e*v.background*t}))}(function(e){for(var t=[],n=[],a=1;a<e.imsize+1;a++)for(var i=1;i<e.imsize+1;i++)t[4*(a-1+(i-1)*e.imsize)+0]=a-(e.imsize+1)/2,t[4*(a-1+(i-1)*e.imsize)+1]=a-(e.imsize+1)/2,t[4*(a-1+(i-1)*e.imsize)+2]=a-(e.imsize+1)/2,t[4*(a-1+(i-1)*e.imsize)+3]=a-(e.imsize+1)/2,n[4*(a-1+(i-1)*e.imsize)+0]=i-(e.imsize+1)/2,n[4*(a-1+(i-1)*e.imsize)+1]=i-(e.imsize+1)/2,n[4*(a-1+(i-1)*e.imsize)+2]=i-(e.imsize+1)/2,n[4*(a-1+(i-1)*e.imsize)+3]=i-(e.imsize+1)/2;for(var o=[],s=0;s<t.length&&s<n.length;s++)o[s]=.5*Math.cos(2*Math.PI*(e.frequency*(Math.sin(Math.PI/180*e.angle)*t[s]+Math.cos(Math.PI/180*e.angle)*n[s])+e.phase));return o}(v),0),{duration:300,amp:1,frequency:500});function w(e,t,n,a){!function(e,t,n,a){if(!a)return;var i=a.createOscillator(),o=a.createGain();i.connect(o),i.frequency.value=t,o.connect(a.destination),o.gain.value=b(e,6418e-7,56.3),i.start(a.currentTime),i.stop(a.currentTime+n/1e3)}(a,e.frequency,n||e.duration,t)}function b(e,t,n){return Math.pow(10,(e-n)/20)*t}var k=n(28),T=n(15),S=n(140),C=k.taskName,E=["updatePdf","warnPdf","normalizePdf","tGuess","tGuessSd","pThreshold","xThreshold","beta","delta","gamma","grain","dim","quantileOrder"];function R(){return N.store.processedData}function _(e){return"component_"+e}function x(e,t,n,a,i,o,s,r){var c=N.store,u=_(e);c[u]={},c[u].decibels=t,c[u].response=n,c[u].responseTime=a,T.isUndefined(i)||(c[u].ratings=i),T.isUndefined(o)||(c[u].ratingsRaw=o),c[u].timestamps=s,c[u].startTimestamp=r,N.save()}function O(){return N.store.encrypted_metadata}function D(){return N.store.survey_url}function I(){return N.store.dataSent}function j(e){N.store.dataSent=e,N.save()}function z(){if(T.isUndefined(O()))return!1;if(T.isUndefined(N.store.quest))return!1;if(!k.debug)for(var e=1;e<=4;e++)if(T.isUndefined((t=e,N.store[_(t)])))return!1;var t;return!0}var N={get store(){if(T.isUndefined(this._store))if(f()){var e=JSON.parse(localStorage.getItem(C));this._store=e||{}}else this._store={};return this._store},save(){f()&&(localStorage.setItem(C,JSON.stringify(this.store)),k.debug&&console.log("saved: "+localStorage.getItem(C)))},clear(){k.debug&&console.log("cleared"),this._store=void 0,f()&&localStorage.removeItem(C)}};function L(){var e=O(),t=I();N.clear(),N.store.encrypted_metadata=e,N.store.dataSent=t,N.save()}var M=n(284),P=n(15),U=function(e){Object(u.a)(n,e);var t=Object(l.a)(n);function n(e){var a;return Object(r.a)(this,n),(a=t.call(this,e)).keyFunction=a.keyFunction.bind(Object(m.a)(a)),a.state={continue:!1,invalid:!1,dataSent:!1},a}return Object(c.a)(n,[{key:"keyFunction",value:function(e){81===e.keyCode&&this.setState((function(e,t){return{continue:!0}}))}},{key:"componentDidMount",value:function(){document.addEventListener("keydown",this.keyFunction,!1);var e,t,n=M.parse(this.props.location.search,{ignoreQueryPrefix:!0});P.isUndefined(n.id)?P.isUndefined(O())&&this.setState({invalid:!0}):(e=n.id)!==N.store.encrypted_metadata&&(N.clear(),N.store.encrypted_metadata=e,N.save()),P.isUndefined(n.survey_url)||(t=n.survey_url,N.store.survey_url=t,N.save()),I()&&this.setState({dataSent:!0})}},{key:"componentWillUnmount",value:function(){document.removeEventListener("keydown",this.keyFunction,!1)}},{key:"render",value:function(){return this.state.invalid?i.a.createElement(d.a,{to:"/Error"}):this.state.dataSent?i.a.createElement(d.a,{to:"/ThankYou"}):!0===this.state.continue?i.a.createElement(d.a,{to:"/Instructions"}):i.a.createElement("div",{className:"Welcome"},i.a.createElement("input",{type:"hidden"}),i.a.createElement("header",{className:"Welcome-header"},i.a.createElement("div",{className:"text-container"},i.a.createElement("p",{className:"Welcome-text"},i.a.createElement("span",{className:"bigger"},"Please set your volume to 100% and then decrease it as needed so that the background noise is not uncomfortably loud but you can still hear the pure tone. Press 'q' on your keyboard to continue. "))),i.a.createElement("a",{href:"https://medicine.yale.edu/psychiatry/care/cmhc/",title:"Learn more about the Connecticut Mental Health Center",target:"_blank",rel:"noopener noreferrer"},i.a.createElement("img",{src:h.a,className:"Site-link",alt:"logo"}))))}}]),n}(a.Component),W=(n(301),a.Component,n(302),function(){return i.a.createElement("div",{className:"NotFound"},i.a.createElement("h3",null,"Sorry, page not found!"))}),K=(n(303),a.Component,n(304),a.Component,n(305),a.Component,n(155)),A=(n(306),n(143),n(150)),F=n.n(A),q=n(151),H=n.n(q),B=n(152),J=n.n(B),G=n(153),V=n.n(G),Y=n(154),Q=n.n(Y),$=(n(15),n(307),{0:"",1:F.a,2:H.a,3:J.a,4:V.a,5:Q.a}),X=function(e){Object(u.a)(n,e);var t=Object(l.a)(n);function n(e){return Object(r.a)(this,n),t.call(this,e)}return Object(c.a)(n,[{key:"drawCanvas",value:function(){this.resizeCanvas();var e=document.getElementById("c"),t=e.getContext("2d"),n=t.getImageData(0,0,e.width,e.height),a=n.data,i=e.width,o=e.height,s=Math.max(100,e.height/8)/2,r=Math.floor(i/s),c=Math.floor(o/s),u=(i/s-r)/2*s;r%2==1&&(u+=s/2);for(var l=0;l<i;l++)for(var d=0;d<o;d++)if(this.props.showContrast){var m=163*Math.abs(Math.floor((l-u)/s)%2);a[4*(l+d*i)+0]=0,a[4*(l+d*i)+1]=0,a[4*(l+d*i)+2]=m,a[4*(l+d*i)+3]=255}else a[4*(l+d*i)+0]=0,a[4*(l+d*i)+1]=0,a[4*(l+d*i)+2]=0,a[4*(l+d*i)+3]=255;t.putImageData(n,0,0)}},{key:"resizeCanvas",value:function(){var e=document.getElementById("c");e.width=window.innerWidth,e.height=window.innerHeight}},{key:"componentDidMount",value:function(){this.drawCanvas()}},{key:"componentDidUpdate",value:function(e){this.drawCanvas()}},{key:"render",value:function(){return i.a.createElement("div",null,i.a.createElement("img",{src:$[this.props.currentRating],width:256,height:256,className:"center",style:{zIndex:101,width:"95vh",height:"50vh",backgroundColor:"black",visibility:this.props.showRatings?"visible":"hidden"}}),i.a.createElement("div",{style:{zIndex:100,backgroundColor:"black",width:"100vw",height:"100vh",position:"fixed",top:0,left:0,visibility:this.props.showRatings?"visible":"hidden"}}),i.a.createElement("canvas",{id:"c",style:{position:"fixed",top:0,left:0,zIndex:1,width:"100%",height:"100%"}}),i.a.createElement("div",{className:"center cross-1",style:{zIndex:10}}),i.a.createElement("div",{className:"center cross-2",style:{zIndex:10}}))}}]),n}(a.Component);X.defaultProps={showContrast:!1,showRatings:!1,contrast:0};var Z=X,ee=n(15),te=n(28),ne=window.AudioContext||window.webkitAudioContext,ae=(ee.map(ee.keys({49:1,50:2,51:3,52:4,53:5}),(function(e){return parseInt(e,10)})),function(e){Object(u.a)(n,e);var t=Object(l.a)(n);function n(e){var a;return Object(r.a)(this,n),(a=t.call(this,e)).playStimulus=function(){var e=Object(m.a)(a);if(te.debug&&e.log_debug(),e.state.index!=e.props.decibels.length)if(e.numAttempts++!=e.numAttemptsLimit){e.setState({responseWindow:!0}),e.startTime=(new Date).getTime(),e.playVisualStimulus(1e3);var t=e.props.decibels[e.state.index];w(y,e.audioContext,1e3,t),a.stimulusTimer=setTimeout(a.playStimulus,e.delay+e.jitter()),a.addTimestamp("stim")}else e.setState({complete:!0});else e.shutdown()},a.recordResponse=function(e){if(a.state.responseWindow&&ee.includes([81,69],e.keyCode)){var t=Object(m.a)(a);a.addTimestamp("resp");var n=(new Date).getTime(),i=81===e.keyCode?1:0;if(a.response.push(i),a.responseTime.push(n-a.startTime),a.setState({responseWindow:!1}),a.timebox=null,a.props.responseHandler(i),a.props.shouldRecordRatings){clearTimeout(a.stimulusTimer),a.setState({ratingWindow:!0,currentRating:t.numIterations||1,stopShowingRating:!1,stopIncrementingRating:!1}),t.numIterations=t.numIterations||0,a.ratingStartTime=(new Date).getTime(),function e(){t.numIterations++,t.ratingTimer=setTimeout((function(){if(5==t.numIterations||t.state.stopShowingRating)return t.numIterations=0,t.prevKey=null,void t.finishRatingWindow();t.state.stopIncrementingRating||t.setState({currentRating:t.state.currentRating+1}),e()}),250)}()}else a.prevKey=null,a.setState({index:a.state.index+1})}else a.prevKey=null},a.keyDownFunction=function(e){if(a.state.readyToStart)return a.setState({readyToStart:!1}),a.audioContext.resume(),void a.startTrial();if(ee.includes([81,69],e.keyCode)){if(a.isKeyDown[e.keyCode])return;a.isKeyDown[e.keyCode]=!0}null===a.prevKey&&(a.prevKey=e.keyCode),a.prevKey===e.keyCode&&(clearTimeout(a.timebox),a.timebox=setTimeout((function(){a.setState({stopIncrementingRating:!1}),a.recordResponse(e)}),50))},a.keyUpFunction=function(e){if(ee.includes([81,69],e.keyCode)&&(a.isKeyDown[e.keyCode]=!1),a.setState({stopIncrementingRating:!0}),a.state.ratingWindow)if(a.timebox)setTimeout((function(){a.timebox=null,a.prevKey=null}),250);else if((1==ee.last(a.response)?81:69)==e.keyCode){a.addTimestamp("rating");var t=(new Date).getTime();a.ratingsRaw.push(t-a.ratingStartTime)}},a.finishRatingWindow=function(){if(a.ratings.push(a.state.currentRating),a.ratings.length>a.ratingsRaw.length){a.addTimestamp("rating");var e=(new Date).getTime();a.ratingsRaw.push(e-a.ratingStartTime),a.setState({stopIncrementingRating:!0})}a.setState({index:a.state.index+1,ratingWindow:!1}),a.stimulusTimer=setTimeout(a.playStimulus,1e3+a.jitter())},a.state={index:0,showContrast:!1,responseWindow:!1,ratingWindow:!1,trialStarted:!1,complete:!1,invalid:!1,readyToStart:!1,dataSent:I(),currentRating:1,stopIncrementingRating:!1,stopShowingRating:!1},a.canvasRef=i.a.createRef(),a.audioContext=new ne,a.initialDelay=2e3,a.delay=2500,a.numAttempts=0,a.numAttemptsLimit=1e3,a.response=[],a.responseTime=[],a.ratings=[],a.ratingsRaw=[],a.timestamps=[],a.ratingTimer=void 0,a.stimulusTimer=void 0,a.componentStartTime=0,a.startTime=0,a.ratingStartTime=0,a.timebox=null,a.numIterations=0,a.isKeyDown={Q_KEY_CODE:!1,E_KEY_CODE:!1},a.prevKey=null,a}return Object(c.a)(n,[{key:"addTimestamp",value:function(e){"start"==e?(this.componentStartTime=(new Date).getTime(),this.timestamps.push([e,0])):this.timestamps.push([e,(new Date).getTime()-this.componentStartTime])}},{key:"playVisualStimulus",value:function(e){var t=this;this.setState({showContrast:!0}),setTimeout((function(){t.setState({showContrast:!1})}),e)}},{key:"startTrial",value:function(){this.setState({trialStarted:!0}),this.stimulusTimer=setTimeout(this.playStimulus,this.initialDelay),function(e){for(var t=3*e.sampleRate,n=e.createBuffer(2,t,e.sampleRate),a=(n.getChannelData(0),0);a<n.numberOfChannels;a++)for(var i=n.getChannelData(a),o=0;o<n.length;o++)i[o]=(2*Math.random()-1)*b(80,.015,78.3);var s=e.createBufferSource();s.buffer=n,s.loop=!0,s.connect(e.destination),s.start(0)}(this.audioContext),this.addTimestamp("start")}},{key:"jitter",value:function(){return Math.random()/2*1e3}},{key:"shutdown",value:function(){this.addTimestamp("end"),this.saveDataToStore(),this.setState({complete:!0})}},{key:"saveDataToStore",value:function(){this.props.dataHandler(this.props.decibels,this.response,this.responseTime,this.ratings,this.ratingsRaw,this.timestamps)}},{key:"componentDidMount",value:function(){var e=this;document.addEventListener("keydown",this.keyDownFunction,!1),document.addEventListener("keyup",this.keyUpFunction,!1),ee.isUndefined(O())&&this.setState({invalid:!0}),!1===this.state.complete&&setTimeout((function(){e.setState({readyToStart:!0})}),0)}},{key:"componentWillUnmount",value:function(){document.removeEventListener("keydown",this.keyDownFunction,!1),document.removeEventListener("keyup",this.keyUpFunction,!1),this.audioContext.close()}},{key:"render",value:function(){return this.state.invalid?i.a.createElement(d.a,{to:"/Error"}):this.state.dataSent?i.a.createElement(d.a,{to:"/ThankYou"}):this.state.complete?this.props.trialCompleteRenderer(this.props.decibels,this.response):i.a.createElement("div",{className:"Trial "+(this.state.trialStarted?"Trial-gray":"")},this.state.trialStarted?i.a.createElement("div",{className:"Trial-stimulus"},i.a.createElement(Z,{showContrast:this.state.showContrast,showRatings:this.state.ratingWindow,currentRating:this.state.currentRating})):i.a.createElement("p",{className:"Trial-text"},this.state.readyToStart?i.a.createElement("span",null,"Press any key to begin"):i.a.createElement("span",null,"Loading...")))}},{key:"log_debug",value:function(){console.log("================================"),console.log("all decibels: "+this.props.decibels),console.log("all responses: "+this.response),console.log("all responseTime: "+this.responseTime),console.log("all timestamps: "+JSON.stringify(this.timestamps)),console.log("all ratingsRaw: "+this.ratingsRaw),console.log("all ratings: "+this.ratings),console.log("index: "+this.state.index),console.log("numAttempts: "+this.numAttempts),console.log("store: "+JSON.stringify(N.store)),console.log("localStorage: "+JSON.stringify(localStorage)),console.log("================================\n")}}]),n}(a.Component));ae.defaultProps={decibels:te.debug?ee.shuffle([65,65,65,65]):ee.concat([65],ee.shuffle([0,0,0,0,0,65,65,65,65])),shouldRecordRatings:!1,trialCompleteRenderer:ee.noop,responseHandler:ee.noop,dataHandler:ee.noop};var ie=ae,oe=n(15),se=n(28);function re(e,t,n){function a(a,i,o,s){return oe.flatten([oe.fill(Array(a),0),oe.fill(Array(i),e),oe.fill(Array(o),t),oe.fill(Array(s),n)])}var i;return i=se.debug?[a(1,1,1,0),a(1,1,1,0),a(1,1,1,0),a(1,1,1,0),a(1,1,1,0),a(1,1,1,0),a(1,1,1,0),a(1,1,1,0),a(1,1,1,0),a(1,1,1,0),a(1,1,1,0),a(1,1,1,0)]:[oe.concat(oe.fill(Array(8),n),oe.shuffle(a(1,0,1,5))),a(4,2,2,7),a(5,3,3,4),a(6,3,3,3),a(6,4,3,2),a(7,3,3,2),a(7,3,4,1),a(7,3,4,1),a(7,3,4,1),a(7,4,3,1),a(7,4,3,1),a(7,4,3,1)],oe.map(i,(function(e,t){return 0==t?e:oe.shuffle(e)}))}function ce(e,t,n){if(oe.isUndefined(ce.blocks))if(3==arguments.length)ce.blocks=re(e,t,n);else{var a=R();if(!oe.isUndefined(a)){var i=a.intensities.c25,o=a.intensities.c50,s=a.intensities.c75;ce.blocks=re(i,o,s)}}return ce.blocks}var ue=n(140),le=n(28),de=(a.Component,n(15),function(e){Object(u.a)(n,e);var t=Object(l.a)(n);function n(e){var a;return Object(r.a)(this,n),(a=t.call(this,e)).trialCompleteRenderer=function(e,t){for(var n=0,a=0;a<t.length;a++)n+=t[a]==e[a]>0;return n>.7*e.length?i.a.createElement(d.a,{to:"/Continue"}):i.a.createElement(d.a,{to:"/OnceMore"})},a.dataHandler=function(e,t,n,i,o,s){x("practice",e,t,n,void 0,void 0,s,a.startTimestamp)},a.startTimestamp=(new Date).getTime(),a}return Object(c.a)(n,[{key:"render",value:function(){return i.a.createElement(ie,{shouldRecordRatings:!1,trialCompleteRenderer:this.trialCompleteRenderer,dataHandler:this.dataHandler})}}]),n}(a.Component)),me=(n(15),a.Component,n(308),a.Component,n(309),a.Component,n(15)),pe=n(28),he=(a.Component,n(15)),fe=(a.Component,n(15)),ge=(a.Component,n(15)),ve=(a.Component,n(81),a.Component,a.Component,a.Component,n(310),n(84)),ye=n(28),we=n(15),be=(a.Component,n(321),function(){return i.a.createElement(d.d,null,i.a.createElement(d.b,{path:"/",exact:!0,component:U}),i.a.createElement(d.b,{path:"/Trial_P",exact:!0,component:de}),i.a.createElement(d.b,{component:W}))}),ke=function(e){Object(u.a)(n,e);var t=Object(l.a)(n);function n(){return Object(r.a)(this,n),t.apply(this,arguments)}return Object(c.a)(n,[{key:"render",value:function(){return i.a.createElement("div",null,i.a.createElement(be,null))}}]),n}(a.Component),Te=n(9),Se=n(14),Ce=Object(Se.a)();Object({NODE_ENV:"production",PUBLIC_URL:"/ach_test_noise",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0}).NODE_CONFIG_DIR="../config",s.a.render(i.a.createElement(Te.a,{history:Ce,basename:"/ach_test_noise"},i.a.createElement(ke,null)),document.getElementById("root"))},53:function(e,t,n){e.exports=n.p+"static/media/psych_logo.6956dbda.jpg"},81:function(e,t,n){},84:function(e,t,n){"use strict";(function(e){n.d(t,"b",(function(){return s})),n.d(t,"a",(function(){return r}));var a=n(311),i=n(147),o=n(28);function s(t,n){return new Promise((function(s,r){var c=i.stringify({encrypted_metadata:t,data:n}),u={hostname:o.awsLambda.saveTaskData.host,port:443,path:o.awsLambda.saveTaskData.path,method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded","Content-Length":e.byteLength(c)}},l=a.request(u,(function(e){e.setEncoding("utf8"),e.on("data",(function(){})),e.on("end",s)}));l.on("error",(function(e){o.debug&&(console.log("ERROR:"),console.log(e)),r(e)})),l.write(c),l.end()}))}function r(t){return new Promise((function(n,s){var r=i.stringify({encrypted_metadata:t}),c={hostname:o.awsLambda.fetchLink.host,port:443,path:o.awsLambda.fetchLink.path,method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded","Content-Length":e.byteLength(r)}},u=a.request(c,(function(e){e.setEncoding("utf8");var t="";e.on("data",(function(e){t+=e})),e.on("end",(function(){return n(t)}))}));u.on("error",(function(e){o.debug&&(console.log("ERROR:"),console.log(e)),s(e)})),u.write(r),u.end()}))}}).call(this,n(7).Buffer)}},[[156,1,2]]]);
//# sourceMappingURL=main.22700110.chunk.js.map